(()=>{"use strict";var e={20:(e,r,t)=>{var n=t(609),a=Symbol.for("react.element"),s=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function p(e,r,t){var n,p={},c=null,u=null;for(n in void 0!==t&&(c=""+t),void 0!==r.key&&(c=""+r.key),void 0!==r.ref&&(u=r.ref),r)s.call(r,n)&&!i.hasOwnProperty(n)&&(p[n]=r[n]);if(e&&e.defaultProps)for(n in r=e.defaultProps)void 0===p[n]&&(p[n]=r[n]);return{$$typeof:a,type:e,key:c,ref:u,props:p,_owner:o.current}}r.jsx=p,r.jsxs=p},83:e=>{e.exports={visa:{niceType:"Visa",type:"visa",patterns:[4],gaps:[4,8,12],lengths:[16,18,19],code:{name:"CVV",size:3}},mastercard:{niceType:"Mastercard",type:"mastercard",patterns:[[51,55],[2221,2229],[223,229],[23,26],[270,271],2720],gaps:[4,8,12],lengths:[16],code:{name:"CVC",size:3}},"american-express":{niceType:"American Express",type:"american-express",patterns:[34,37],gaps:[4,10],lengths:[15],code:{name:"CID",size:4}},"diners-club":{niceType:"Diners Club",type:"diners-club",patterns:[[300,305],36,38,39],gaps:[4,10],lengths:[14,16,19],code:{name:"CVV",size:3}},discover:{niceType:"Discover",type:"discover",patterns:[6011,[644,649],65],gaps:[4,8,12],lengths:[16,19],code:{name:"CID",size:3}},jcb:{niceType:"JCB",type:"jcb",patterns:[2131,1800,[3528,3589]],gaps:[4,8,12],lengths:[16,17,18,19],code:{name:"CVV",size:3}},unionpay:{niceType:"UnionPay",type:"unionpay",patterns:[620,[62100,62182],[62184,62187],[62185,62197],[62200,62205],[622010,622999],622018,[62207,62209],[623,626],6270,6272,6276,[627700,627779],[627781,627799],[6282,6289],6291,6292,810,[8110,8131],[8132,8151],[8152,8163],[8164,8171]],gaps:[4,8,12],lengths:[14,15,16,17,18,19],code:{name:"CVN",size:3}},maestro:{niceType:"Maestro",type:"maestro",patterns:[493698,[5e5,504174],[504176,506698],[506779,508999],[56,59],63,67,6],gaps:[4,8,12],lengths:[12,13,14,15,16,17,18,19],code:{name:"CVC",size:3}},elo:{niceType:"Elo",type:"elo",patterns:[401178,401179,438935,457631,457632,431274,451416,457393,504175,[506699,506778],[509e3,509999],627780,636297,636368,[650031,650033],[650035,650051],[650405,650439],[650485,650538],[650541,650598],[650700,650718],[650720,650727],[650901,650978],[651652,651679],[655e3,655019],[655021,655058]],gaps:[4,8,12],lengths:[16],code:{name:"CVE",size:3}},mir:{niceType:"Mir",type:"mir",patterns:[[2200,2204]],gaps:[4,8,12],lengths:[16,17,18,19],code:{name:"CVP2",size:3}},hiper:{niceType:"Hiper",type:"hiper",patterns:[637095,63737423,63743358,637568,637599,637609,637612],gaps:[4,8,12],lengths:[16],code:{name:"CVC",size:3}},hipercard:{niceType:"Hipercard",type:"hipercard",patterns:[606282],gaps:[4,8,12],lengths:[16],code:{name:"CVC",size:3}}}},101:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.findBestMatch=void 0,r.findBestMatch=function(e){return function(e){var r=e.filter((function(e){return e.matchStrength})).length;return r>0&&r===e.length}(e)?e.reduce((function(e,r){return e?Number(e.matchStrength)<Number(r.matchStrength)?r:e:r})):null}},209:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.addMatchingCardsToResults=void 0;var n=t(788),a=t(256);r.addMatchingCardsToResults=function(e,r,t){var s,o;for(s=0;s<r.patterns.length;s++){var i=r.patterns[s];if((0,a.matches)(e,i)){var p=(0,n.clone)(r);o=Array.isArray(i)?String(i[0]).length:String(i).length,e.length>=o&&(p.matchStrength=o),t.push(p);break}}}},256:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.matches=void 0,r.matches=function(e,r){return Array.isArray(r)?function(e,r,t){var n=String(r).length,a=e.substr(0,n),s=parseInt(a,10);return r=parseInt(String(r).substr(0,a.length),10),t=parseInt(String(t).substr(0,a.length),10),s>=r&&s<=t}(e,r[0],r[1]):function(e,r){return(r=String(r)).substring(0,e.length)===e.substring(0,r.length)}(e,r)}},609:e=>{e.exports=window.React},664:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isValidInputType=void 0,r.isValidInputType=function(e){return"string"==typeof e||e instanceof String}},788:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clone=void 0,r.clone=function(e){return e?JSON.parse(JSON.stringify(e)):null}},848:(e,r,t)=>{e.exports=t(20)},961:function(e,r,t){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e},n.apply(this,arguments)},a=t(83),s=t(209),o=t(664),i=t(101),p=t(788),c={},u={VISA:"visa",MASTERCARD:"mastercard",AMERICAN_EXPRESS:"american-express",DINERS_CLUB:"diners-club",DISCOVER:"discover",JCB:"jcb",UNIONPAY:"unionpay",MAESTRO:"maestro",ELO:"elo",MIR:"mir",HIPER:"hiper",HIPERCARD:"hipercard"},l=[u.VISA,u.MASTERCARD,u.AMERICAN_EXPRESS,u.DINERS_CLUB,u.DISCOVER,u.JCB,u.UNIONPAY,u.MAESTRO,u.ELO,u.MIR,u.HIPER,u.HIPERCARD],d=(0,p.clone)(l);function g(e){return c[e]||a[e]}function y(e,r){void 0===r&&(r=!1);var t=d.indexOf(e);if(!r&&-1===t)throw new Error('"'+e+'" is not a supported card type.');return t}function m(e){var r=[];if(!(0,o.isValidInputType)(e))return r;if(0===e.length)return d.map((function(e){return(0,p.clone)(g(e))}));d.forEach((function(t){var n=g(t);(0,s.addMatchingCardsToResults)(e,n,r)}));var t=(0,i.findBestMatch)(r);return t?[t]:r}m.getTypeInfo=function(e){return(0,p.clone)(g(e))},m.removeCard=function(e){var r=y(e);d.splice(r,1)},m.addCard=function(e){var r=y(e.type,!0);c[e.type]=e,-1===r&&d.push(e.type)},m.updateCard=function(e,r){var t=c[e]||a[e];if(!t)throw new Error('"'.concat(e,"\" is not a recognized type. Use `addCard` instead.'"));if(r.type&&t.type!==r.type)throw new Error("Cannot overwrite type parameter.");var s=(0,p.clone)(t);s=n(n({},s),r),c[s.type]=s},m.changeOrder=function(e,r){var t=y(e);d.splice(t,1),d.splice(r,0,e)},m.resetModifications=function(){d=(0,p.clone)(l),c={}},m.types=u,e.exports=m}},r={};function t(n){var a=r[n];if(void 0!==a)return a.exports;var s=r[n]={exports:{}};return e[n].call(s.exports,s,s.exports,t),s.exports}t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);const n=window.wp.i18n,a=window.wc.wcBlocksRegistry,s=window.wp.htmlEntities,o=window.wp.element,i=window.wc.wcSettings,p=window.wc.blocksCheckout;var c,u=t(961),l=t.n(u),d=t(848);const g=(0,i.getPaymentMethodData)("borgun_rpg",{}),y=(0,n.__)("Teya RPG","borgun_rpg"),m=(0,s.decodeEntities)(g?.title||"")||y,h=g?.publickey||"",f=g?.logoUrl,b=()=>(0,s.decodeEntities)(g.description||""),v=()=>{if(g.testmode){const e=(0,n.__)("In test mode, you can use the card number 4741520000000003 with any CVC and a valid expiration date","borgun_rpg");return(0,d.jsx)("div",{class:"borgun-rpg-testmode-notice",children:(0,d.jsx)("i",{children:e})})}},_=e=>{const[r,t]=(0,o.useState)(""),[a,s]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),{eventRegistration:u,emitResponse:g}=e,{onPaymentSetup:y}=u;return(0,o.useEffect)((()=>{const e=y((async()=>{if(h){if(BAPIjs.setPublicToken(h),!1===BAPIjs.isValidCardNumber(r))return{type:g.responseTypes.ERROR,message:(0,n.__)("Invalid card number","borgun_rpg")};var e=a.split("/"),t="00";0 in e&&(t=e[0].replace(/\s+/g,""));var s="00";if(1 in e&&(s=e[1].replace(/\s+/g,"")),!1===BAPIjs.isValidExpDate(t,s))return{type:g.responseTypes.ERROR,message:(0,n.__)("Invalid expiration date","borgun_rpg")};if(!1===BAPIjs.isValidCVC(i))return{type:g.responseTypes.ERROR,message:(0,n.__)("Invalid cvc number","borgun_rpg")};let o=(0,n.__)("Not authorized, token failed","borgun_rpg"),p="";const c=new Promise(((e,a)=>{BAPIjs.getToken({pan:r,expMonth:t,expYear:s,cvc:i},(function(r,t){201===r.statusCode?p=t.Token:o=401===r.statusCode?(0,n.__)("Unauthorized received from TeyaPaymentAPI","borgun_rpg"):r.statusCode?(0,n.__)("Error received from TeyaPaymentAPI","borgun_rpg")+" "+r.statusCode+" - "+r.message:(0,n.__)("Unable to connect to server","borgun_rpg"),e([p,o])}))})),u=await c;return u[0]?{type:g.responseTypes.SUCCESS,meta:{paymentMethodData:{"borgun-rpg-card-token":u[0]}}}:{type:g.responseTypes.ERROR,message:u[1]}}return{type:g.responseTypes.ERROR,message:(0,n.__)("There was an error","borgun_rpg")}}));return()=>{e()}}),[g.responseTypes.ERROR,g.responseTypes.SUCCESS,y,r,a,i]),[(0,d.jsx)(b,{}),(0,d.jsx)(v,{}),(0,d.jsxs)("div",{className:"borgun-rpg-fields wc-block-card-elements",children:[(0,d.jsx)("div",{className:"borgun-rpg-payment-field borgun-rpg-payment-card wc-block-gateway-container wc-card-number-element",children:(0,d.jsx)(p.ValidatedTextInput,{id:"borgun-rpg-card-number",name:"borgun-rpg-card-number",type:"tel",required:!0,class:"borgun-rpg-input borgun-rpg-card-input",label:(0,n.__)("Card number","borgun_rpg"),inputmode:"numeric",maxlength:"19",autocomplete:"cc-number",value:r,onChange:e=>{e?/^-?\d+$/.test(e)?t(e):t(null!=r?r:""):t("")},customValidation:(e,r)=>{if(e.value&&parseInt(e.value.length)>4){const r=l()(e.value);if(1==r.length){const t=r[0].lengths;if(parseInt(t[0])<=parseInt(e.value.length))return!0}}return e.setCustomValidity((0,n.__)("Please enter a valid Card number","borgun_rpg")),!1}})}),(0,d.jsx)("div",{className:"borgun-rpg-payment-field borgun-rpg-payment-field-c-expiry wc-block-gateway-container wc-card-expiry-element",children:(0,d.jsx)(p.ValidatedTextInput,{id:"borgun-rpg-card-expiry",type:"tel",required:!0,class:"borgun-rpg-input borgun-rpg-card-expiry-input",label:(0,n.__)("Expiry Date","borgun_rpg"),value:a,maxlength:"5",onChange:e=>{const r=e.split("/"),t=e.length;if(a.length>t)2==t&&(e=e.slice(0,-1)),s(null!=e?e:"");else{let n=!0;r.forEach(((e,r)=>{n=!!/^-?\d+$/.test(e)&&(0!==r||e<=12&&"00"!==e)})),2==t&&(e+="/"),s(n?null!=e?e:"":null!=a?a:"")}},customValidation:e=>{if(e.value&&parseInt(e.value.length)>4){const r=e.value.split("/"),t=new Date,n=t.getMonth(),a=t.getFullYear(),s=parseInt("20"+r[1]),o=parseInt(r[0]);if(s>a&&s<a+20){if(o>0&&o<=12)return!0}else if(s==a&&o>=n+1&&o<=12)return!0}return e.setCustomValidity((0,n.__)("Please enter a valid Expiry (MM/YY)","borgun_rpg")),!1}})}),(0,d.jsx)("div",{className:"borgun-rpg-payment-field borgun-rpg-payment-field-cvc wc-block-gateway-container wc-card-cvc-element",children:(0,d.jsx)(p.ValidatedTextInput,{id:"borgun-rpg-card-cvc",type:"tel",name:"borgun-rpg-card-cvc",required:!0,class:"borgun-rpg-input borgun-rpg-card-cvc-input",autocorrect:"no",spellcheck:"no",label:(0,n.__)("Card code","borgun_rpg"),maxlength:"4",value:i,onChange:e=>{/^-?\d+$/.test(e)?c(null!=e?e:""):c(null!=i?i:"")}})})]})]},C=e=>{const{PaymentMethodLabel:r}=e.components;return[(0,d.jsx)(r,{text:m}),(0,d.jsx)(R,{})]};function R(){return(0,d.jsx)("div",{class:"wc-borgun-rpg-payment-gateway-block-checkout-logo",children:(0,d.jsx)("img",{src:f,alt:m})})}const w={name:"borgun_rpg",label:(0,d.jsx)(C,{}),content:(0,d.jsx)(_,{}),edit:(0,d.jsx)(_,{}),canMakePayment:()=>!0,ariaLabel:m,supports:{features:null!==(c=g?.supports)&&void 0!==c?c:[]}};(0,a.registerPaymentMethod)(w)})();